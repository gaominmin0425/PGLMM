---
title: "my_vignette"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{my_vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r}
#library(PGLMM)
library(tidyverse)
library(ggplot2)
# Load data
tortoise <- read.csv("~/Desktop/Asc/PGLMM/R/gopher_tortoise.csv")
#summary the datatset
summary(tortoise)
```


```{r}
# scatter Plot: relationship between shells and prev
s1 <- tortoise %>%
  ggplot(aes(x = prev,y=shells)) +
  geom_point()+
  geom_smooth(method=lm)
# scatter Plot: relationship between shells and year
s2 <- tortoise %>%
  ggplot(aes(x = year,y=shells)) +
  geom_point()+
  geom_smooth(method=lm)

```

```{r}
#put two plots togther
library(patchwork)
s1+s2
```
1. There is a positive relationship between parameter prev and response shells. As prev increases, the number of shell will also increases. 
2.It seems there is no clear relatioonship between the parameter year and response shells.


```{r}
#histogram of prev
h1<- tortoise %>%
  ggplot(aes(x = prev,y = ..density..)) +
  geom_histogram(binwidth = 10) + 
  geom_density()+#add density curve
  ggtitle("histogram of prev")#add title

h1
```
1. There is a decreasing density curve for prev.
2. The distribution is skewed to the right and unimodal. 

```{r}
#boxplot of year
b1 <- ggplot(tortoise, aes(as.factor(year), y=shells,color=year)) + 
  geom_boxplot()+
  xlab("Year")+
  ylab("number of shells")+
  ggtitle("Boxplot of year")#add title

b2 <- ggplot(tortoise, aes(x=prev, y=shells,group=2)) + 
  geom_boxplot()+
  xlab("prev")+
  ylab("number of shells")+
  ggtitle("Boxplot of year")#add title
#put two plots togther
library(patchwork)
b1+b2
```
For parameter year
1. year 2004 has a more dispersed the data than year 2005 and 2006.
2. They have same median.Buit,the median is the upper quantile for year 2005. The median is the lower quantile for year 2006.
3. The boxplot of year 2004 is skewed right. 
For parameter prev
1. The boxplot of prev is skewed right. the median is closer to the lower quantitle. 



```{r}
#plot of estimation from bootsrap function
# Load data
## return for bootstrap
Gopher = para_bootstrap(100,tortoise, tortoise_fit$beta[2])
## For plots
tortoise = tortoise %>% mutate(Year2005 = ifelse(tortoise$year == "2005",1,0), Year2006 = ifelse(tortoise$year=="2006", 1,0))
tortoise_fit <- run_model(tortoise, "tortoise")
Sigmasq = tortoise_fit$sigmasq
## compute bootstrap standard error and confidence interval in terms of prev
Gopher %>% filter(term == "prev") %>% summarize(SD = sd(estimate),Lower95 = quantile(estimate, .025),Upper95 = quantile(estimate,.975))


#histogram 
#data of intercept
p1 <- Gopher %>% filter(term == "(Intercept)")%>%select("estimate") %>%
  ggplot(aes(x=estimate,y=..density..))+ 
  geom_histogram(bindwidth=30)+
  geom_density()+    #add density curve
  ggtitle("histogram of intercept")+
  geom_vline(xintercept = tortoise_fit$beta[1], colour="green")  #true mean
p1
library(ggplot2)
q1<- Gopher %>% filter(term == "(Intercept)")%>%select("estimate") %>%
  ggplot(aes(sample=estimate)) +
  geom_qq() +
  geom_qq_line()+
  labs(title="QQ plot of intercept")
q1
```
Histogram with density function,and true mean 
1. parameter normality holds.
2. the true mean(green line) is approximate at the center.
QQ plot
1. parameter normality holds since most of the data are around the line patter even there are some outliers.
```{r}
#put two plots togther
library(patchwork)
p1+q1
```


```{r}
#data of prev
p2 <- Gopher %>% filter(term == "prev")%>%select("estimate") %>%
  ggplot(aes(x = estimate,y=..density..)) +
  geom_histogram(bindwidth=30)+
  geom_density()+    #add density curve
  ggtitle("histogram of prev")+
  geom_vline(xintercept = tortoise_fit$beta[2], colour="green") #true mean
p2

q2 <- Gopher %>% filter(term == "prev")%>%select("estimate") %>%
  ggplot(aes(sample=estimate)) +
  geom_qq() +
  geom_qq_line()+
  labs(title="QQ plot of prev")
q2
```
Histogram with density function,and true mean 
1. parameter normality holds.
2. the true mean(green line) is approximate at the center.
QQ plot
1. parameter normality holds since most of the data are around the line patter even there are some outliers.

```{r}
#put two plots togther
library(patchwork)
p2+q2
```

```{r}
#data of factor(year)2005
p3 <- Gopher %>% filter(term == "factor(year)2005")%>%select("estimate") %>%
  ggplot(aes(x = estimate,y=..density..)) +
  geom_histogram(bindwidth=30)+
  geom_density()+     #add density curve
  ggtitle("histogram of factor(year)2005")+
  geom_vline(xintercept = tortoise_fit$beta[3], colour="green")  #true mean
p3

q3 <- Gopher %>% filter(term == "factor(year)2005")%>%select("estimate") %>%
  ggplot(aes(sample=estimate)) +
  geom_qq() +
  geom_qq_line()+
  labs(title=" QQ plot of factor(year)2005")
q3
```
Histogram with density function,and true mean 
1. parameter normality holds.
2. the true mean(green line) is approximate at the center(left side a lit).

QQ plot
1.parameter normality holds since most of the data are around the line patter even there are some outliers.

```{r}
#put two plots togther
library(patchwork)
p3+q3
```


```{r}
#data of factor(year)2006
p4 <- Gopher %>% filter(term == "factor(year)2006")%>%select("estimate") %>%
  ggplot(aes(x = estimate,y=..density..)) +
  geom_histogram(bindwidth=30)+
  geom_density()+     #add density curve
  ggtitle("histogram of factor(year)2006")+
  geom_vline(xintercept = tortoise_fit$beta[4], colour="green")  #true mean
p4

q4<- Gopher %>% filter(term == "factor(year)2006")%>%select("estimate") %>%
  ggplot(aes(sample=estimate)) +
  geom_qq() +
  geom_qq_line()+
  labs(title=" QQ plot of factor(year)2006")
q4
```
Histogram with density function,and true mean 
1. parameter normality holds.
2. the true mean(green line) is approximate at the center.

QQ plot
1. parameter normality holds since most of the data are around the line patter even there are some outliers.

```{r}
#put two plots togther
library(patchwork)
p4+q4
```



```{r}
#data of sd__(Intercept)
p5 <- Gopher %>% filter(term == "sd__(Intercept)")%>%select("estimate") %>%
  ggplot(aes(x = estimate,y=..density..)) +
  geom_histogram(bindwidth=30)+
  geom_density()+  #add density curve
  ggtitle("histogram of sd__(Intercept)")+
  geom_vline(xintercept =tortoise_fit$sigmasq, colour="green")   #true mean
p5
q5<- Gopher %>% filter(term == "sd__(Intercept)")%>%select("estimate") %>%
  ggplot(aes(sample=estimate)) +
  geom_qq() +
  geom_qq_line()+
  labs(title=" QQ plot of sd__(Intercept)")
q5
```
Histogram with density function and qq plot
1. sigmasq is 0. 

```{r}
#put two plots togther
library(patchwork)
p5+q5
```







